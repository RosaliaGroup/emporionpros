<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sign In ‚Äî Emporion Pros</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="app.js"></script>
<style>
body{background:linear-gradient(135deg,#1e3a8a,#1a56db);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.auth-box{background:white;border-radius:20px;padding:40px;width:100%;max-width:420px;box-shadow:0 25px 60px rgba(0,0,0,.25)}
.auth-logo{font-size:24px;font-weight:800;color:#1a56db;margin-bottom:6px}.auth-logo span{color:#f97316}
.auth-title{font-size:26px;font-weight:800;margin-bottom:6px}
.auth-sub{color:#6b7280;font-size:14px;margin-bottom:28px}
.auth-switch{text-align:center;font-size:13px;margin-top:20px;color:#6b7280}
.ep-label{font-size:13px;font-weight:600;color:#374151;display:block;margin-bottom:6px}
.auth-switch a{color:#1a56db;font-weight:600;text-decoration:none}
.panel{display:none}.panel.active{display:block}
</style>
</head>
<body>
<div class="auth-box">
  <div class="auth-logo">Emporion<span>Pros</span></div>

  <!-- LOGIN PANEL -->
  <div class="panel active" id="panel-login">
    <div class="auth-title">Welcome back</div>
    <div class="auth-sub">Sign in to your account</div>
    <div id="error-msg" style="display:none;background:#fee2e2;color:#b91c1c;padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px">‚ùå Incorrect email or password. Please try again.</div>
    <form onsubmit="doLogin(event)">
      <div class="ep-form-group"><label class="ep-label">Email Address</label><input class="ep-input" id="login-email" type="email" placeholder="you@example.com" required></div>
      <div class="ep-form-group"><label class="ep-label">Password</label><input class="ep-input" id="login-password" type="password" placeholder="Your password" required></div>
      <div style="text-align:right;font-size:12px;margin-top:-10px;margin-bottom:16px"><a href="#" onclick="showPanel('forgot')" style="color:#1a56db;text-decoration:none">Forgot password?</a></div>
      <button type="submit" class="ep-btn ep-btn-primary" style="width:100%;padding:14px;font-size:15px">Sign In ‚Üí</button>
    </form>
    <div class="auth-switch">Don't have an account? <a href="signup.html">Create one free</a></div>
    <div class="auth-switch" style="margin-top:8px"><a href="index.html" style="color:#6b7280">‚Üê Back to homepage</a></div>
  </div>

  <!-- FORGOT PASSWORD PANEL -->
  <div class="panel" id="panel-forgot">
    <div class="auth-title">Reset Password</div>
    <div class="auth-sub">Enter the email you signed up with</div>
    <div id="forgot-error" style="display:none;background:#fee2e2;color:#b91c1c;padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px"></div>
    <form onsubmit="doForgot(event)">
      <div class="ep-form-group"><label class="ep-label">Email Address</label><input class="ep-input" id="forgot-email" type="email" placeholder="you@example.com" required></div>
      <button type="submit" class="ep-btn ep-btn-primary" style="width:100%;padding:14px;font-size:15px">Find My Account ‚Üí</button>
    </form>
    <div class="auth-switch"><a href="#" onclick="showPanel('login')" style="color:#6b7280">‚Üê Back to Sign In</a></div>
  </div>

  <!-- RESET PASSWORD PANEL -->
  <div class="panel" id="panel-reset">
    <div style="text-align:center;margin-bottom:20px;font-size:40px">üîê</div>
    <div class="auth-title">New Password</div>
    <div class="auth-sub" id="reset-sub">Set a new password for your account</div>
    <div id="reset-error" style="display:none;background:#fee2e2;color:#b91c1c;padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px"></div>
    <form onsubmit="doReset(event)">
      <div class="ep-form-group"><label class="ep-label">New Password</label><input class="ep-input" id="new-password" type="password" placeholder="At least 6 characters" minlength="6" required></div>
      <div class="ep-form-group"><label class="ep-label">Confirm New Password</label><input class="ep-input" id="confirm-password" type="password" placeholder="Repeat your new password" required></div>
      <button type="submit" class="ep-btn ep-btn-primary" style="width:100%;padding:14px;font-size:15px">Save New Password ‚Üí</button>
    </form>
    <div class="auth-switch"><a href="#" onclick="showPanel('login')" style="color:#6b7280">‚Üê Back to Sign In</a></div>
  </div>

  <!-- SUCCESS PANEL -->
  <div class="panel" id="panel-success">
    <div style="text-align:center;padding:20px 0">
      <div style="font-size:56px;margin-bottom:16px">‚úÖ</div>
      <div class="auth-title">Password Reset!</div>
      <div class="auth-sub">Your password has been updated. You can now sign in.</div>
      <button class="ep-btn ep-btn-primary" style="width:100%;padding:14px;font-size:15px;margin-top:16px" onclick="showPanel('login')">Sign In Now ‚Üí</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => EP.injectStyles());
let resetEmail = '';

function showPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
}

function doLogin(e) {
  e.preventDefault();
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const password = document.getElementById('login-password').value;
  const errorMsg = document.getElementById('error-msg');
  const users = EP.store.get('ep_users') || [];
  const user = users.find(u => u.email.toLowerCase() === email && u.password === password);
  if (!user) { errorMsg.style.display = 'block'; document.getElementById('login-password').value = ''; return; }
  errorMsg.style.display = 'none';
  EP.auth.login({ name: user.name, email: user.email, role: user.role, loggedIn: true });
  EP.notify('Welcome back, ' + user.name.split(' ')[0] + '! üëã', 'success');
  setTimeout(() => {
    if (user.role === 'agent') window.location.href = 'agent-dashboard.html';
    else if (user.role === 'vendor') window.location.href = 'vendor-dashboard.html';
    else window.location.href = 'listings.html';
  }, 800);
}

function doForgot(e) {
  e.preventDefault();
  const email = document.getElementById('forgot-email').value.trim().toLowerCase();
  const errEl = document.getElementById('forgot-error');
  const users = EP.store.get('ep_users') || [];
  const user = users.find(u => u.email.toLowerCase() === email);
  if (!user) {
    errEl.style.display = 'block';
    errEl.textContent = '‚ùå No account found with that email. Check the spelling or create a new account.';
    return;
  }
  errEl.style.display = 'none';
  resetEmail = email;
  document.getElementById('reset-sub').textContent = 'Setting new password for ' + email;
  showPanel('reset');
}

function doReset(e) {
  e.preventDefault();
  const newPass = document.getElementById('new-password').value;
  const confirmPass = document.getElementById('confirm-password').value;
  const errEl = document.getElementById('reset-error');
  if (newPass !== confirmPass) { errEl.style.display = 'block'; errEl.textContent = '‚ùå Passwords do not match.'; return; }
  if (newPass.length < 6) { errEl.style.display = 'block'; errEl.textContent = '‚ùå Password must be at least 6 characters.'; return; }
  const users = EP.store.get('ep_users') || [];
  const idx = users.findIndex(u => u.email.toLowerCase() === resetEmail);
  if (idx > -1) { users[idx].password = newPass; EP.store.set('ep_users', users); }
  showPanel('success');
}
</script>
</body>
</html>
