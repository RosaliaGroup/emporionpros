<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Log In — Emporion Pros</title>
<meta name="description" content="Log in to your Emporion Pros account.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="ep-supabase.js"></script>
<script src="app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#f3f4f6;min-height:100vh}
.auth-page{display:flex;min-height:100vh}
.auth-left{flex:1;background:linear-gradient(135deg,#1e3a8a 0%,#1a56db 60%,#1e40af 100%);color:white;display:flex;align-items:center;justify-content:center;padding:60px}
.auth-left-content{max-width:480px}
.auth-left h1{font-size:42px;font-weight:800;margin-bottom:16px;line-height:1.2}
.auth-left h1 em{color:#fbbf24;font-style:normal}
.auth-left p{font-size:18px;opacity:.85;line-height:1.7;margin-bottom:32px}
.auth-features{list-style:none}
.auth-features li{padding:8px 0;font-size:15px;opacity:.9}
.auth-features li::before{content:'✓';margin-right:10px;color:#fbbf24;font-weight:700}
.auth-right{flex:1;display:flex;align-items:center;justify-content:center;padding:40px}
.auth-card{background:white;border-radius:16px;padding:48px;max-width:440px;width:100%;box-shadow:0 4px 24px rgba(0,0,0,.08)}
.auth-logo{font-size:24px;font-weight:800;color:#1a56db;margin-bottom:8px}
.auth-logo span{color:#f97316}
.auth-subtitle{color:#6b7280;font-size:15px;margin-bottom:32px}
.auth-form label{display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:6px}
.auth-form input{width:100%;padding:12px 16px;border:1.5px solid #e5e7eb;border-radius:8px;font-size:14px;font-family:inherit;margin-bottom:16px;transition:.2s}
.auth-form input:focus{outline:none;border-color:#1a56db;box-shadow:0 0 0 3px rgba(26,86,219,.1)}
.auth-submit{width:100%;padding:14px;background:#1a56db;color:white;border:none;border-radius:8px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:.2s}
.auth-submit:hover{background:#1e3a8a}
.auth-submit:disabled{background:#93c5fd;cursor:not-allowed}
.auth-divider{text-align:center;margin:24px 0;color:#9ca3af;font-size:13px;position:relative}
.auth-divider::before,.auth-divider::after{content:'';position:absolute;top:50%;width:40%;height:1px;background:#e5e7eb}
.auth-divider::before{left:0}
.auth-divider::after{right:0}
.auth-link{text-align:center;margin-top:24px;font-size:14px;color:#6b7280}
.auth-link a{color:#1a56db;font-weight:600;text-decoration:none}
.auth-link a:hover{text-decoration:underline}
.auth-error{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px;display:none}
.auth-success{background:#f0fdf4;border:1px solid #bbf7d0;color:#059669;padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px;display:none}
.forgot-link{float:right;font-size:12px;color:#1a56db;text-decoration:none;font-weight:500}
.forgot-link:hover{text-decoration:underline}
@media(max-width:768px){.auth-left{display:none}.auth-right{padding:20px}}
</style>
</head>
<body>
<div class="auth-page">
  <div class="auth-left">
    <div class="auth-left-content">
      <h1>Welcome Back to<br><em>Emporion Pros</em></h1>
      <p>Your complete real estate ecosystem. Manage listings, leads, campaigns, and more — all from one platform.</p>
      <ul class="auth-features">
        <li>AI-powered lead generation & campaigns</li>
        <li>Appointment booking & calendar management</li>
        <li>Vendor marketplace with 900+ providers</li>
        <li>E-signature & document management</li>
        <li>24/7 AI assistant (Aria)</li>
      </ul>
    </div>
  </div>
  <div class="auth-right">
    <div class="auth-card">
      <div class="auth-logo">Emporion<span>Pros</span></div>
      <div class="auth-subtitle">Log in to your account</div>

      <div class="auth-error" id="auth-error"></div>
      <div class="auth-success" id="auth-success"></div>

      <!-- Login Form -->
      <form class="auth-form" id="login-form" onsubmit="handleLogin(event)">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required>

        <label for="password">Password <a href="#" class="forgot-link" onclick="showForgot(event)">Forgot password?</a></label>
        <input type="password" id="password" name="password" placeholder="Enter your password" required minlength="6">

        <button type="submit" class="auth-submit" id="login-btn">Log In</button>
      </form>

      <!-- Forgot Password Form (hidden) -->
      <form class="auth-form" id="forgot-form" style="display:none" onsubmit="handleForgot(event)">
        <label for="forgot-email">Email Address</label>
        <input type="email" id="forgot-email" placeholder="you@example.com" required>
        <button type="submit" class="auth-submit">Send Reset Link</button>
        <div style="text-align:center;margin-top:12px">
          <a href="#" onclick="showLogin(event)" style="color:#1a56db;font-size:13px;text-decoration:none">← Back to login</a>
        </div>
      </form>

      <div class="auth-link">
        Don't have an account? <a href="/signup.html">Sign up free</a>
      </div>
    </div>
  </div>
</div>

<script>
async function handleLogin(e) {
  e.preventDefault();
  const btn = document.getElementById('login-btn');
  const errorEl = document.getElementById('auth-error');
  const successEl = document.getElementById('auth-success');
  errorEl.style.display = 'none';
  successEl.style.display = 'none';
  btn.disabled = true;
  btn.textContent = 'Logging in...';

  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  const { data, error } = await EPAuth.signIn(email, password);

  if (error) {
    errorEl.textContent = error.message === 'Invalid login credentials' 
      ? 'Invalid email or password. Please try again.' 
      : error.message;
    errorEl.style.display = 'block';
    btn.disabled = false;
    btn.textContent = 'Log In';
    return;
  }

  successEl.textContent = 'Login successful! Redirecting...';
  successEl.style.display = 'block';

  // Get profile to determine redirect
  const profile = await EPAuth.getProfile();
  const role = profile?.role || 'user';

  setTimeout(() => {
    if (role === 'agent') window.location.href = '/agent-dashboard.html';
    else if (role === 'vendor') window.location.href = '/vendor-dashboard.html';
    else window.location.href = '/agent-dashboard.html';
  }, 800);
}

async function handleForgot(e) {
  e.preventDefault();
  const email = document.getElementById('forgot-email').value;
  const errorEl = document.getElementById('auth-error');
  const successEl = document.getElementById('auth-success');
  errorEl.style.display = 'none';

  const { error } = await EPAuth.resetPassword(email);
  if (error) {
    errorEl.textContent = error.message;
    errorEl.style.display = 'block';
    return;
  }
  successEl.textContent = 'Password reset link sent! Check your email.';
  successEl.style.display = 'block';
}

function showForgot(e) {
  e.preventDefault();
  document.getElementById('login-form').style.display = 'none';
  document.getElementById('forgot-form').style.display = 'block';
  document.getElementById('auth-error').style.display = 'none';
  document.getElementById('auth-success').style.display = 'none';
}

function showLogin(e) {
  e.preventDefault();
  document.getElementById('login-form').style.display = 'block';
  document.getElementById('forgot-form').style.display = 'none';
  document.getElementById('auth-error').style.display = 'none';
  document.getElementById('auth-success').style.display = 'none';
}

// Redirect if already logged in
(async () => {
  const user = await EPAuth.getUser();
  if (user) window.location.href = '/agent-dashboard.html';
})();
</script>
</body>
</html>
