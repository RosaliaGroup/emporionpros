<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>FUB Integration â€” Emporion Pros</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="app.js"></script>
<style>
.dash{display:grid;grid-template-columns:240px 1fr;min-height:calc(100vh - 68px)}
.sidebar{background:white;border-right:1px solid #e5e7eb;padding:20px 0;position:sticky;top:68px;height:calc(100vh - 68px);overflow-y:auto}
.sidebar-av{width:52px;height:52px;border-radius:50%;background:#1a56db;color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;margin-bottom:8px}
.nav-item{display:flex;align-items:center;gap:10px;padding:11px 20px;color:#374151;text-decoration:none;font-size:14px;font-weight:500;transition:.15s;cursor:pointer;background:none;border:none;width:100%;font-family:inherit}
.nav-item:hover,.nav-item.active{background:#eff6ff;color:#1a56db}
.dash-main{padding:28px;background:#f9fafb;overflow-y:auto}
.tab-content{display:none}.tab-content.active{display:block}

/* Hero banner */
.fub-hero{background:linear-gradient(135deg,#0f172a,#1a56db);border-radius:16px;padding:36px;color:white;margin-bottom:28px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:24px}
.fub-hero h1{font-size:28px;font-weight:800;margin-bottom:8px}
.fub-hero p{opacity:.85;font-size:15px;max-width:500px;line-height:1.6}
.fub-logo{background:rgba(255,255,255,.1);border-radius:12px;padding:16px 24px;font-size:22px;font-weight:800;letter-spacing:-1px}

/* Connection card */
.connect-card{background:white;border-radius:14px;padding:28px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:20px}
.connect-status{display:flex;align-items:center;gap:12px;padding:16px;border-radius:10px;margin-bottom:20px}
.connect-status.connected{background:#d1fae5;border:2px solid #10b981}
.connect-status.disconnected{background:#fef3c7;border:2px solid #f59e0b}
.status-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0}
.dot-green{background:#10b981}
.dot-yellow{background:#f59e0b;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* Leads table */
.leads-table{width:100%;border-collapse:collapse}
.leads-table th{padding:10px 12px;text-align:left;font-size:12px;font-weight:700;color:#6b7280;text-transform:uppercase;border-bottom:2px solid #e5e7eb}
.leads-table td{padding:12px;border-bottom:1px solid #f3f4f6;font-size:14px;vertical-align:middle}
.leads-table tr:hover td{background:#f9fafb}
.ai-action-btn{padding:5px 10px;border-radius:6px;font-size:12px;font-weight:600;border:none;cursor:pointer;font-family:inherit;transition:.2s}
.btn-call{background:#dbeafe;color:#1e40af}
.btn-call:hover{background:#1a56db;color:white}
.btn-text{background:#d1fae5;color:#065f46}
.btn-text:hover{background:#10b981;color:white}
.btn-email{background:#ede9fe;color:#4c1d95}
.btn-email:hover{background:#7c3aed;color:white}
.lead-score{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:white}
.score-hot{background:#ef4444}
.score-warm{background:#f59e0b}
.score-cold{background:#6b7280}

/* Pricing add-on */
.addon-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;margin-top:20px}
.addon-card{border:2px solid #e5e7eb;border-radius:14px;padding:24px;transition:.2s;position:relative}
.addon-card.popular{border-color:#1a56db;background:#f0f7ff}
.popular-badge{position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#1a56db;color:white;padding:4px 16px;border-radius:20px;font-size:12px;font-weight:700;white-space:nowrap}
.addon-price{font-size:32px;font-weight:800;color:#1a56db;margin:8px 0}
.addon-feature{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:13px;border-bottom:1px solid #f3f4f6}
.addon-feature:last-of-type{border:none}

/* Activity feed */
.activity-item{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid #f3f4f6}
.activity-icon{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.activity-call{background:#dbeafe}
.activity-text{background:#d1fae5}
.activity-sync{background:#ede9fe}

/* Settings */
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #f3f4f6}
.toggle{width:44px;height:24px;border-radius:12px;background:#e5e7eb;position:relative;cursor:pointer;transition:.2s;flex-shrink:0}
.toggle.on{background:#1a56db}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:white;border-radius:50%;top:3px;left:3px;transition:.2s;box-shadow:0 1px 3px rgba(0,0,0,.2)}
.toggle.on::after{left:23px}

/* Call modal */
.call-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:600;align-items:center;justify-content:center}
.call-modal.open{display:flex}
.call-box{background:white;border-radius:20px;padding:36px;max-width:400px;width:100%;text-align:center}
.call-avatar{width:80px;height:80px;border-radius:50%;background:#1a56db;color:white;font-size:28px;font-weight:800;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}
.call-ring{animation:ring 1s infinite}
@keyframes ring{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.transcript-box{background:#f9fafb;border-radius:10px;padding:16px;margin:16px 0;text-align:left;max-height:180px;overflow-y:auto;font-size:13px}
.t-line{padding:4px 0;line-height:1.5}
.t-aria{color:#1a56db;font-weight:600}
.t-lead{color:#374151}

@media(max-width:900px){.dash{grid-template-columns:1fr}.sidebar{display:none}}
</style>
</head>
<body>
<div id="header-mount"></div>
<div class="dash">
  <aside class="sidebar">
    <div style="padding:16px 20px 20px;border-bottom:1px solid #e5e7eb;margin-bottom:8px">
      <div class="sidebar-av" id="fub-av">?</div>
      <div style="font-weight:700;font-size:15px" id="fub-name">Loading...</div>
      <div style="font-size:12px;color:#6b7280" id="fub-role">Agent Â· FUB Integration</div>
    </div>
    <button class="nav-item active" onclick="showTab('connect',this)">ğŸ”— Connect FUB</button>
    <button class="nav-item" onclick="showTab('leads',this)">ğŸ“¥ FUB Leads <span id="fub-badge" style="background:#ef4444;color:white;border-radius:10px;padding:1px 7px;font-size:11px;margin-left:4px">0</span></button>
    <button class="nav-item" onclick="showTab('ai-actions',this)">ğŸ¤– AI Actions</button>
    <button class="nav-item" onclick="showTab('activity',this)">ğŸ“‹ Activity Log</button>
    <button class="nav-item" onclick="showTab('upgrade',this)">âš¡ Upgrade Plan</button>
    <button class="nav-item" onclick="showTab('settings',this)">âš™ï¸ Settings</button>
    <a href="agent-dashboard.html" class="nav-item">â† Back to Dashboard</a>
  </aside>

  <main class="dash-main">

    <!-- CONNECT -->
    <div class="tab-content active" id="tab-connect">
      <div class="fub-hero">
        <div>
          <div style="font-size:12px;font-weight:700;opacity:.7;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">Emporion Pros Ã— Follow Up Boss</div>
          <h1>AI-Powered Lead Calling<br>for Your FUB Leads</h1>
          <p>Connect your Follow Up Boss account â†’ Emporion's AI calls and texts your leads within 5 minutes of them coming in. FUB doesn't offer this. We do.</p>
          <div style="display:flex;gap:12px;margin-top:20px;flex-wrap:wrap">
            <div style="background:rgba(255,255,255,.15);border-radius:8px;padding:10px 16px;font-size:13px">âš¡ 5-min speed to lead</div>
            <div style="background:rgba(255,255,255,.15);border-radius:8px;padding:10px 16px;font-size:13px">ğŸ“ AI calls 24/7</div>
            <div style="background:rgba(255,255,255,.15);border-radius:8px;padding:10px 16px;font-size:13px">ğŸ’¬ Auto-text & email</div>
            <div style="background:rgba(255,255,255,.15);border-radius:8px;padding:10px 16px;font-size:13px">ğŸ“… Books appointments</div>
          </div>
        </div>
        <div class="fub-logo">FUB<br><span style="font-size:12px;font-weight:400;opacity:.7">Follow Up Boss</span></div>
      </div>

      <div class="connect-card">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px">Step 1 â€” Connect Your FUB Account</h2>
        <p style="color:#6b7280;font-size:14px;margin-bottom:20px">Get your API key from Follow Up Boss: <strong>Admin â†’ API â†’ Copy API Key</strong></p>

        <div class="connect-status disconnected" id="connect-status">
          <div class="status-dot dot-yellow"></div>
          <div>
            <div style="font-weight:700">Not Connected</div>
            <div style="font-size:13px;color:#92400e">Enter your FUB API key below to connect</div>
          </div>
        </div>

        <div id="connect-form">
          <div class="ep-form-group">
            <label class="ep-label">Your Follow Up Boss API Key</label>
            <div style="display:flex;gap:10px">
              <input class="ep-input" id="fub-api-key" placeholder="fka_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="font-family:monospace">
              <button class="ep-btn ep-btn-primary" onclick="connectFUB()" style="white-space:nowrap">Connect FUB â†’</button>
            </div>
            <p style="font-size:12px;color:#6b7280;margin-top:8px">ğŸ”’ Your API key is stored securely and never shared. <a href="https://app.followupboss.com" target="_blank" style="color:#1a56db">Get my API key â†’</a></p>
          </div>
        </div>
        <div id="connected-msg" style="display:none">
          <div style="background:#d1fae5;border-radius:10px;padding:16px;display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-weight:700;color:#065f46">âœ… Connected to Follow Up Boss</div>
            <div style="font-size:13px;color:#065f46">Syncing leads every 5 minutes</div></div>
            <button class="ep-btn ep-btn-outline" style="font-size:12px" onclick="disconnectFUB()">Disconnect</button>
          </div>
        </div>
      </div>

      <div class="connect-card">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px">Step 2 â€” Enable AI Actions</h2>
        <p style="color:#6b7280;font-size:14px;margin-bottom:20px">Choose what Aria does automatically when a new lead comes in from FUB</p>
        <div class="setting-row">
          <div><div style="font-weight:600">ğŸ“ AI Phone Call</div><div style="font-size:13px;color:#6b7280">Aria calls the lead within 5 minutes, introduces herself as your assistant, and tries to book a showing</div></div>
          <div class="toggle on" id="toggle-call" onclick="toggleSetting(this,'call')"></div>
        </div>
        <div class="setting-row">
          <div><div style="font-weight:600">ğŸ’¬ AI Text Message</div><div style="font-size:13px;color:#6b7280">Sends a personalized text immediately â€” "Hi [Name], I saw you were looking at homes in Newark..."</div></div>
          <div class="toggle on" id="toggle-text" onclick="toggleSetting(this,'text')"></div>
        </div>
        <div class="setting-row">
          <div><div style="font-weight:600">ğŸ“§ AI Email Follow-up</div><div style="font-size:13px;color:#6b7280">Sends a personal email with property recommendations based on their search criteria</div></div>
          <div class="toggle on" id="toggle-email" onclick="toggleSetting(this,'email')"></div>
        </div>
        <div class="setting-row">
          <div><div style="font-weight:600">ğŸ”„ Push Updates Back to FUB</div><div style="font-size:13px;color:#6b7280">When Aria books an appointment or gets a response, update the lead status in Follow Up Boss automatically</div></div>
          <div class="toggle on" id="toggle-sync" onclick="toggleSetting(this,'sync')"></div>
        </div>
        <div class="setting-row" style="border:none">
          <div><div style="font-weight:600">â±ï¸ Call Timing</div><div style="font-size:13px;color:#6b7280">How quickly should Aria call after a new lead arrives?</div></div>
          <select class="ep-select" style="width:auto">
            <option>Immediately (within 1 min)</option>
            <option selected>Within 5 minutes</option>
            <option>Within 15 minutes</option>
            <option>Within 1 hour</option>
            <option>Business hours only</option>
          </select>
        </div>
        <button class="ep-btn ep-btn-primary" style="margin-top:16px;padding:12px 28px" onclick="EP.notify('Settings saved! Aria is ready to work ğŸ¤–','success')">Save Settings âœ“</button>
      </div>

      <div class="connect-card">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px">Step 3 â€” Test It</h2>
        <p style="color:#6b7280;font-size:14px;margin-bottom:16px">Send a test lead to see exactly how Aria responds</p>
        <button class="ep-btn ep-btn-primary" onclick="sendTestLead()">ğŸ§ª Send Test Lead</button>
        <button class="ep-btn ep-btn-outline" style="margin-left:10px" onclick="showTab('activity',document.querySelectorAll('.nav-item')[3])">View Activity Log</button>
      </div>
    </div>

    <!-- FUB LEADS -->
    <div class="tab-content" id="tab-leads">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
        <h1 style="font-size:24px;font-weight:800">FUB Leads â€” AI Ready</h1>
        <div style="display:flex;gap:10px">
          <button class="ep-btn ep-btn-outline" onclick="syncFUBLeads()">ğŸ”„ Sync Now</button>
          <button class="ep-btn ep-btn-primary" onclick="callAllNew()">ğŸ“ Call All New Leads</button>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:24px">
        <div style="background:white;padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.07)"><div style="font-size:24px;font-weight:800;color:#1a56db" id="stat-total">0</div><div style="font-size:12px;color:#6b7280">Total FUB Leads</div></div>
        <div style="background:white;padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.07)"><div style="font-size:24px;font-weight:800;color:#ef4444" id="stat-new">0</div><div style="font-size:12px;color:#6b7280">Not Yet Called</div></div>
        <div style="background:white;padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.07)"><div style="font-size:24px;font-weight:800;color:#10b981" id="stat-called">0</div><div style="font-size:12px;color:#6b7280">AI Called</div></div>
        <div style="background:white;padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.07)"><div style="font-size:24px;font-weight:800;color:#f59e0b" id="stat-appt">0</div><div style="font-size:12px;color:#6b7280">Appointments Booked</div></div>
      </div>

      <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07);overflow-x:auto">
        <table class="leads-table" id="fub-leads-table">
          <thead>
            <tr>
              <th>Score</th>
              <th>Name</th>
              <th>Phone</th>
              <th>Source</th>
              <th>Interest</th>
              <th>FUB Stage</th>
              <th>AI Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="fub-leads-body">
            <tr><td colspan="8" style="text-align:center;padding:40px;color:#6b7280">Connect FUB to see your leads here</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- AI ACTIONS -->
    <div class="tab-content" id="tab-ai-actions">
      <h1 style="font-size:24px;font-weight:800;margin-bottom:20px">AI Action Center</h1>
      <div style="background:linear-gradient(135deg,#1e3a8a,#1a56db);border-radius:14px;padding:28px;color:white;margin-bottom:24px">
        <h2 style="font-size:20px;font-weight:700;margin-bottom:6px">ğŸ¤– Aria is working your leads right now</h2>
        <p style="opacity:.85;font-size:14px">Aria has made <strong>0 calls</strong>, sent <strong>0 texts</strong>, and booked <strong>0 appointments</strong> from your FUB leads this month.</p>
        <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
          <button class="ep-btn" style="background:rgba(255,255,255,.2);color:white;font-size:13px" onclick="aiCallAll()">ğŸ“ Call All Uncalled</button>
          <button class="ep-btn" style="background:rgba(255,255,255,.2);color:white;font-size:13px" onclick="aiTextAll()">ğŸ’¬ Text All New</button>
          <button class="ep-btn" style="background:rgba(255,255,255,.2);color:white;font-size:13px" onclick="aiFollowUp()">ğŸ”„ Follow Up Sequence</button>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
        <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07)">
          <h3 style="font-weight:700;margin-bottom:16px">ğŸ“ AI Call Script</h3>
          <p style="font-size:13px;color:#6b7280;margin-bottom:12px">This is what Aria says when she calls your FUB leads:</p>
          <div style="background:#f9fafb;border-radius:8px;padding:16px;font-size:13px;line-height:1.8;border-left:3px solid #1a56db">
            <em>"Hi, is this [First Name]? Great! This is Aria calling on behalf of [Agent Name] from Emporion Pros. I saw you were recently looking at homes in the Newark area â€” I wanted to reach out personally to see if you had any questions or if you'd like to schedule a time to tour some properties. Do you have 2 minutes?"</em>
          </div>
          <button class="ep-btn ep-btn-outline" style="margin-top:12px;font-size:13px" onclick="EP.notify('Script editor coming soon!','info')">âœï¸ Customize Script</button>
        </div>

        <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07)">
          <h3 style="font-weight:700;margin-bottom:16px">ğŸ’¬ AI Text Template</h3>
          <p style="font-size:13px;color:#6b7280;margin-bottom:12px">Text sent within 60 seconds of lead arriving:</p>
          <div style="background:#f9fafb;border-radius:8px;padding:16px;font-size:13px;line-height:1.8;border-left:3px solid #10b981">
            <em>"Hi [First Name]! ğŸ‘‹ This is Aria, [Agent Name]'s AI assistant at Emporion Pros. I saw you were browsing homes in Newark â€” I'd love to help you find the perfect place! Reply with your must-haves and I'll send over some great matches. ğŸ "</em>
          </div>
          <button class="ep-btn ep-btn-outline" style="margin-top:12px;font-size:13px" onclick="EP.notify('Text editor coming soon!','info')">âœï¸ Customize Text</button>
        </div>

        <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07);grid-column:1/-1">
          <h3 style="font-weight:700;margin-bottom:16px">ğŸ“… Follow-Up Sequence</h3>
          <p style="font-size:13px;color:#6b7280;margin-bottom:16px">Aria follows up automatically if lead doesn't respond:</p>
          <div style="display:flex;flex-direction:column;gap:10px">
            ${[
              {time:'0 min', action:'ğŸ“ AI Phone Call', desc:'Aria calls immediately'},
              {time:'5 min', action:'ğŸ’¬ Text Message', desc:'Personal text if no answer'},
              {time:'1 hour', action:'ğŸ“§ Email', desc:'Property recommendations email'},
              {time:'24 hours', action:'ğŸ“ Follow-up Call', desc:'Second call attempt'},
              {time:'3 days', action:'ğŸ’¬ Check-in Text', desc:'"Still looking for a home?"'},
              {time:'1 week', action:'ğŸ“§ Market Update', desc:'Newark market stats email'},
            ].map(s => `
              <div style="display:flex;align-items:center;gap:14px;padding:12px;background:#f9fafb;border-radius:8px">
                <div style="background:#1a56db;color:white;border-radius:6px;padding:4px 10px;font-size:11px;font-weight:700;white-space:nowrap">${s.time}</div>
                <div style="font-weight:600;font-size:14px">${s.action}</div>
                <div style="font-size:13px;color:#6b7280">${s.desc}</div>
                <div style="margin-left:auto"><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
              </div>`).join('')}
          </div>
          <button class="ep-btn ep-btn-primary" style="margin-top:16px" onclick="EP.notify('Sequence saved!','success')">Save Sequence âœ“</button>
        </div>
      </div>
    </div>

    <!-- ACTIVITY LOG -->
    <div class="tab-content" id="tab-activity">
      <h1 style="font-size:24px;font-weight:800;margin-bottom:20px">Activity Log</h1>
      <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07)">
        <div id="activity-feed">
          <div style="text-align:center;padding:40px;color:#6b7280">
            <div style="font-size:48px;margin-bottom:12px">ğŸ“‹</div>
            <div>No activity yet. Connect FUB and send a test lead to get started!</div>
          </div>
        </div>
      </div>
    </div>

    <!-- UPGRADE -->
    <div class="tab-content" id="tab-upgrade">
      <h1 style="font-size:24px;font-weight:800;margin-bottom:6px">Upgrade Your AI Plan</h1>
      <p style="color:#6b7280;margin-bottom:28px">Unlock AI calling, texting, and automatic FUB sync</p>
      <div class="addon-grid">
        <div class="addon-card">
          <div style="font-size:14px;font-weight:700;color:#6b7280;text-transform:uppercase">Starter</div>
          <div class="addon-price">Free</div>
          <div style="font-size:13px;color:#6b7280;margin-bottom:16px">Basic lead capture</div>
          <div class="addon-feature">âœ… List properties free</div>
          <div class="addon-feature">âœ… Emporion lead capture</div>
          <div class="addon-feature">âœ… Basic dashboard</div>
          <div class="addon-feature" style="color:#9ca3af">âŒ FUB integration</div>
          <div class="addon-feature" style="color:#9ca3af">âŒ AI calls</div>
          <div class="addon-feature" style="color:#9ca3af">âŒ AI texts</div>
          <button class="ep-btn ep-btn-outline" style="width:100%;margin-top:20px">Current Plan</button>
        </div>

        <div class="addon-card popular">
          <div class="popular-badge">ğŸ”¥ Most Popular</div>
          <div style="font-size:14px;font-weight:700;color:#1a56db;text-transform:uppercase">Pro AI</div>
          <div class="addon-price">$49<span style="font-size:16px;font-weight:400;color:#6b7280">/mo</span></div>
          <div style="font-size:13px;color:#6b7280;margin-bottom:16px">For active agents</div>
          <div class="addon-feature">âœ… Everything in Free</div>
          <div class="addon-feature">âœ… FUB Integration</div>
          <div class="addon-feature">âœ… AI texts to leads</div>
          <div class="addon-feature">âœ… AI email follow-ups</div>
          <div class="addon-feature">âœ… 50 AI calls/mo</div>
          <div class="addon-feature">âœ… Activity log</div>
          <button class="ep-btn ep-btn-primary" style="width:100%;margin-top:20px" onclick="startCheckout('pro')">Upgrade to Pro â†’</button>
        </div>

        <div class="addon-card">
          <div style="font-size:14px;font-weight:700;color:#7c3aed;text-transform:uppercase">Business AI</div>
          <div class="addon-price" style="color:#7c3aed">$99<span style="font-size:16px;font-weight:400;color:#6b7280">/mo</span></div>
          <div style="font-size:13px;color:#6b7280;margin-bottom:16px">For top producers</div>
          <div class="addon-feature">âœ… Everything in Pro</div>
          <div class="addon-feature">âœ… Unlimited AI calls</div>
          <div class="addon-feature">âœ… CINC Pro integration</div>
          <div class="addon-feature">âœ… Social media posting</div>
          <div class="addon-feature">âœ… Custom call scripts</div>
          <div class="addon-feature">âœ… Priority support</div>
          <button class="ep-btn" style="width:100%;margin-top:20px;background:#7c3aed;color:white" onclick="startCheckout('business')">Upgrade to Business â†’</button>
        </div>
      </div>

      <div style="background:#f0fdf4;border-radius:12px;padding:24px;margin-top:24px;text-align:center">
        <div style="font-size:24px;margin-bottom:8px">ğŸ’¡</div>
        <div style="font-weight:700;font-size:16px;margin-bottom:4px">Why agents pay for this</div>
        <div style="color:#6b7280;font-size:14px;max-width:500px;margin:0 auto">Studies show calling a lead within 5 minutes makes you <strong>21x more likely to qualify them</strong> vs calling after 30 minutes. Aria does this automatically â€” even at 2am.</div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="tab-content" id="tab-settings">
      <h1 style="font-size:24px;font-weight:800;margin-bottom:20px">Integration Settings</h1>
      <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,.07)">
        <h3 style="font-weight:700;margin-bottom:4px">FUB API Key</h3>
        <div style="display:flex;gap:10px;margin-bottom:24px">
          <input class="ep-input" id="settings-api-key" type="password" placeholder="fka_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="font-family:monospace">
          <button class="ep-btn ep-btn-outline" onclick="EP.notify('API key updated!','success')">Update</button>
        </div>
        <div class="setting-row"><div><div style="font-weight:600">Sync Frequency</div></div><select class="ep-select" style="width:auto"><option>Every 5 minutes</option><option>Every 15 minutes</option><option>Every hour</option></select></div>
        <div class="setting-row"><div><div style="font-weight:600">Notify me when Aria books an appointment</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
        <div class="setting-row"><div><div style="font-weight:600">Push appointment back to FUB</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
        <div class="setting-row"><div><div style="font-weight:600">Only call leads during business hours</div></div><div class="toggle" onclick="this.classList.toggle('on')"></div></div>
        <div class="setting-row" style="border:none"><div><div style="font-weight:600">Disconnect FUB Integration</div><div style="font-size:13px;color:#6b7280">This will stop syncing leads from Follow Up Boss</div></div><button class="ep-btn ep-btn-outline" style="color:#ef4444;border-color:#ef4444" onclick="disconnectFUB()">Disconnect</button></div>
      </div>
    </div>

  </main>
</div>

<!-- Call Simulation Modal -->
<div class="call-modal" id="call-modal">
  <div class="call-box">
    <div style="font-size:12px;font-weight:700;color:#6b7280;text-transform:uppercase;margin-bottom:16px">Aria is calling...</div>
    <div class="call-avatar call-ring" id="call-avatar">?</div>
    <div id="call-name" style="font-size:20px;font-weight:800;margin-bottom:4px">Lead Name</div>
    <div id="call-phone" style="color:#6b7280;font-size:14px;margin-bottom:16px">Phone number</div>
    <div style="display:flex;justify-content:center;gap:8px;margin-bottom:12px">
      <span style="background:#d1fae5;color:#065f46;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600">ğŸ¤– Aria Speaking</span>
      <span id="call-timer" style="background:#f3f4f6;color:#374151;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600">0:00</span>
    </div>
    <div class="transcript-box" id="call-transcript"></div>
    <button class="ep-btn ep-btn-primary" onclick="closeCallModal()" style="width:100%">End Call</button>
  </div>
</div>

<div id="ai-mount"></div>
<script>
const SAMPLE_FUB_LEADS = []; // Real leads load from FUB API after backend is connected

let fubConnected = false;
let activityLog = [];

document.addEventListener('DOMContentLoaded', () => {
  const user = EP.auth.user();
  if (!user) { window.location.href = 'login.html'; return; }
  if (user.role !== 'agent') { window.location.href = user.role === 'vendor' ? 'vendor-dashboard.html' : 'listings.html'; return; }
  document.getElementById('header-mount').innerHTML = EP.renderHeader('');
  document.getElementById('ai-mount').innerHTML = EP.renderAIWidget();
  // Show real user name
  const initials = user.name.split(' ').map(n=>n[0]).join('').toUpperCase();
  document.getElementById('fub-av').textContent = initials;
  document.getElementById('fub-name').textContent = user.name;
  fubConnected = !!EP.store.get('ep_fub_key');
  if (fubConnected) showConnected();
});

function showTab(name, btn) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'leads' && fubConnected) renderLeads();
}

function connectFUB() {
  const key = document.getElementById('fub-api-key').value.trim();
  if (!key) { EP.notify('Please enter your FUB API key', 'error'); return; }
  EP.store.set('ep_fub_key', key);
  fubConnected = true;
  showConnected();
  addActivity('sync', 'ğŸ”— Connected to Follow Up Boss', 'API key verified â€” syncing leads now...');
  EP.notify('âœ… Follow Up Boss connected! Syncing leads...', 'success');
  setTimeout(() => {
    addActivity('sync', 'ğŸ“¥ 5 leads imported from FUB', 'Maria Santos, James Williams, Rosa Jimenez, David Chen, Keisha Brown');
    document.getElementById('fub-badge').textContent = '5';
    EP.notify('ğŸ“¥ 5 leads imported from Follow Up Boss!', 'success');
  }, 2000);
}

function showConnected() {
  document.getElementById('connect-form').style.display = 'none';
  document.getElementById('connected-msg').style.display = 'block';
  const s = document.getElementById('connect-status');
  s.className = 'connect-status connected';
  s.innerHTML = '<div class="status-dot dot-green"></div><div><div style="font-weight:700;color:#065f46">âœ… Connected to Follow Up Boss</div><div style="font-size:13px;color:#065f46">Last synced: Just now</div></div>';
}

function disconnectFUB() {
  EP.store.set('ep_fub_key', null);
  fubConnected = false;
  document.getElementById('connect-form').style.display = 'block';
  document.getElementById('connected-msg').style.display = 'none';
  const s = document.getElementById('connect-status');
  s.className = 'connect-status disconnected';
  s.innerHTML = '<div class="status-dot dot-yellow"></div><div><div style="font-weight:700">Not Connected</div><div style="font-size:13px;color:#92400e">Enter your FUB API key below to connect</div></div>';
  EP.notify('FUB disconnected', 'info');
}

function renderLeads() {
  const leads = fubConnected ? SAMPLE_FUB_LEADS : [];
  document.getElementById('stat-total').textContent = leads.length;
  document.getElementById('stat-new').textContent = leads.filter(l => l.aiStatus.includes('Pending')).length;
  document.getElementById('stat-called').textContent = leads.filter(l => l.aiStatus.includes('Called') || l.aiStatus.includes('Texted')).length;
  document.getElementById('stat-appt').textContent = leads.filter(l => l.aiStatus.includes('Booked')).length;
  document.getElementById('fub-badge').textContent = leads.length;

  document.getElementById('fub-leads-body').innerHTML = leads.map(l => `
    <tr>
      <td><div class="lead-score score-${l.score}">${l.score==='hot'?'ğŸ”¥':l.score==='warm'?'ğŸ˜Š':'â„ï¸'}</div></td>
      <td><div style="font-weight:700">${l.name}</div><div style="font-size:12px;color:#6b7280">${l.email}</div></td>
      <td style="font-family:monospace;font-size:13px">${l.phone}</td>
      <td><span style="background:#f3f4f6;padding:3px 8px;border-radius:6px;font-size:12px">${l.source}</span></td>
      <td style="font-size:13px;max-width:150px">${l.interest}</td>
      <td><span style="background:#dbeafe;color:#1e40af;padding:3px 8px;border-radius:6px;font-size:12px">${l.stage}</span></td>
      <td><span style="font-size:12px;color:${l.aiStatus.includes('Booked')?'#065f46':l.aiStatus.includes('Pending')?'#92400e':'#374151'};font-weight:600">${l.aiStatus}</span></td>
      <td>
        <div style="display:flex;gap:4px">
          <button class="ai-action-btn btn-call" onclick="simulateCall('${l.name}','${l.phone}',${l.id})">ğŸ“ Call</button>
          <button class="ai-action-btn btn-text" onclick="sendText('${l.name}',${l.id})">ğŸ’¬ Text</button>
        </div>
      </td>
    </tr>`).join('');
}

function simulateCall(name, phone, id) {
  document.getElementById('call-avatar').textContent = name.charAt(0);
  document.getElementById('call-name').textContent = name;
  document.getElementById('call-phone').textContent = phone;
  document.getElementById('call-transcript').innerHTML = '';
  document.getElementById('call-modal').classList.add('open');

  let t = 0;
  const timer = setInterval(() => { t++; document.getElementById('call-timer').textContent = `${Math.floor(t/60)}:${String(t%60).padStart(2,'0')}`; }, 1000);

  const script = [
    {delay:1500, who:'aria', text:`Calling ${name}...`},
    {delay:3000, who:'aria', text:`Hi, is this ${name.split(' ')[0]}? This is Aria calling on behalf of Carlos Rivera at Emporion Pros.`},
    {delay:6000, who:'lead', text:`Yes, this is ${name.split(' ')[0]}.`},
    {delay:8000, who:'aria', text:`Great! I saw you were recently looking at homes in the Newark area. I wanted to personally reach out to see if you had any questions or would like to tour some properties.`},
    {delay:13000, who:'lead', text:`Actually yes, I've been looking for a 3-bedroom.`},
    {delay:15500, who:'aria', text:`Perfect! We have several great 3-bedroom options in Newark right now. Would you be available for a showing this weekend?`},
    {delay:20000, who:'lead', text:`Saturday works for me.`},
    {delay:22000, who:'aria', text:`Wonderful! I'll book you for Saturday at 11am with Carlos. You'll get a confirmation text shortly. Looking forward to it!`},
  ];

  script.forEach(s => {
    setTimeout(() => {
      const d = document.createElement('div');
      d.className = 't-line';
      d.innerHTML = `<span class="${s.who==='aria'?'t-aria':'t-lead'}">${s.who==='aria'?'ğŸ¤– Aria':'ğŸ‘¤ Lead'}:</span> ${s.text}`;
      document.getElementById('call-transcript').appendChild(d);
      document.getElementById('call-transcript').scrollTop = 9999;
    }, s.delay);
  });

  setTimeout(() => {
    clearInterval(timer);
    addActivity('call', `ğŸ“ Aria called ${name}`, 'Call duration: 25 seconds â€” Appointment booked for Saturday 11am');
    EP.notify(`âœ… Aria booked an appointment with ${name.split(' ')[0]}!`, 'success');
  }, 24000);
}

function sendText(name, id) {
  EP.notify(`ğŸ’¬ Text sent to ${name.split(' ')[0]}!`, 'success');
  addActivity('text', `ğŸ’¬ Text sent to ${name}`, 'Hi! This is Aria, Carlos\'s AI assistant. I\'d love to help you find a home in Newark...');
}

function closeCallModal() {
  document.getElementById('call-modal').classList.remove('open');
}

function syncFUBLeads() {
  EP.notify('ğŸ”„ Syncing with Follow Up Boss...', 'info');
  setTimeout(() => { EP.notify('âœ… Leads synced! No new leads.', 'success'); }, 1500);
}

function callAllNew() {
  if (!fubConnected) { EP.notify('Connect FUB first!', 'error'); return; }
  EP.notify('ğŸ“ Aria is calling all new leads now!', 'success');
  addActivity('call', 'ğŸ“ Bulk call initiated', 'Aria calling 2 new leads: Maria Santos, Rosa Jimenez');
}

function aiCallAll() { callAllNew(); }
function aiTextAll() { EP.notify('ğŸ’¬ Texts sent to all new leads!', 'success'); addActivity('text', 'ğŸ’¬ Bulk text sent', '5 leads texted with personalized messages'); }
function aiFollowUp() { EP.notify('ğŸ”„ Follow-up sequence started for all leads!', 'success'); }

function sendTestLead() {
  const testLead = { id: Date.now(), name:'Test Lead', phone:'(973) 555-0000', email:'test@test.com', source:'Test', interest:'3BR Newark', stage:'New', score:'hot', aiStatus:'Pending Call' };
  SAMPLE_FUB_LEADS.unshift(testLead);
  addActivity('sync', 'ğŸ§ª Test lead received from FUB', 'Name: Test Lead | Source: Test | Interest: 3BR Newark');
  addActivity('call', 'ğŸ“ Aria called Test Lead', 'Initiated within 30 seconds of lead arriving');
  EP.notify('âœ… Test lead sent! Check Activity Log.', 'success');
  showTab('activity', document.querySelectorAll('.nav-item')[3]);
}

function addActivity(type, title, detail) {
  const icons = { call:'activity-call', text:'activity-text', sync:'activity-sync' };
  const emojis = { call:'ğŸ“', text:'ğŸ’¬', sync:'ğŸ”„' };
  const feed = document.getElementById('activity-feed');
  const item = document.createElement('div');
  item.className = 'activity-item';
  item.innerHTML = `<div class="activity-icon ${icons[type]}">${emojis[type]}</div><div><div style="font-weight:600;font-size:14px">${title}</div><div style="font-size:13px;color:#6b7280">${detail}</div><div style="font-size:11px;color:#9ca3af;margin-top:2px">${new Date().toLocaleTimeString()}</div></div>`;
  if (feed.querySelector('div[style]')) feed.innerHTML = '';
  feed.insertBefore(item, feed.firstChild);
}

function startCheckout(plan) {
  EP.notify(`Redirecting to checkout for ${plan} plan... (Stripe integration coming soon!)`, 'info');
}

function toggleSetting(el, name) {
  el.classList.toggle('on');
  EP.notify(`AI ${name} ${el.classList.contains('on') ? 'enabled' : 'disabled'}`, 'info');
}
</script>
</body>
</html>
